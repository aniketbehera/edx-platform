<%inherit file="/main.html" />
<%namespace name='static' file='/static_content.html'/>

<%block name="headextra">
  <%static:css group='course'/>
</%block>

<%namespace name="progress_graph" file="/courseware/progress_graph.js"/>

<%block name="title"><title>${course.number} Progress</title></%block>

<%!
    from django.core.urlresolvers import reverse
%>

<%! from xmodule.util.date_utils import get_default_time_display %>

<%block name="js_extra">
<script type="text/javascript" src="${static.url('js/vendor/flot/jquery.flot.js')}"></script>
<script type="text/javascript" src="${static.url('js/vendor/flot/jquery.flot.stack.js')}"></script>
<script type="text/javascript" src="${static.url('js/vendor/flot/jquery.flot.symbol.js')}"></script>
<script>
${progress_graph.body(grade_summary, course.grade_cutoffs, "grade-detail-graph", not course.no_grade, not course.no_grade)}

var default_badge_info = "<h2>Badges</h2>";
var badge_detail_box = "#badge_detail_box";
var restore_default = function() {
  //$(badge_detail_box).html(default_badge_info);
  $(badge_detail_box).hide(0);
}
$("img.badgelet").hover(
  function() {
      $(badge_detail_box).stop();
      $(badge_detail_box).show();
      $(badge_detail_box).fadeOut({'duration': 0});
      $(badge_detail_box).html($(this).attr('badge_detail'));
      $(badge_detail_box).fadeIn({'duration': 0});
  },
  function() {
      $(badge_detail_box).stop();
      $(badge_detail_box).fadeOut(1000, function() {
        restore_default();
      });
      $(badge_detail_box).fadeIn();

  }

);
restore_default();

</script>

<style>
img.badgelet {
  margin: 10px;
  height: 60px;
  border-radius: 7px;
}
img.badgelet:hover {
  box-shadow: 0px 0px 15px rgb(29,157,217);
}
img.unlockable {
            filter: url("data:image/svg+xml;utf8,<svg xmlns=\'http://www.w3.org/2000/svg\'><filter id=\'grayscale\'><feColorMatrix type=\'matrix\' values=\'0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0.3333 0.3333 0.3333 0 0 0 0 0 1 0\'/></filter></svg>#grayscale"); /* Firefox 10+, Firefox on Android */
            filter: grayscale( 100% );
            filter: gray;
    -webkit-filter: grayscale( 100% );
       -moz-filter: grayscale( 100% );
         -o-filter: grayscale( 100% );
        -ms-filter: grayscale( 100% );
}
img.unlockable:hover {
  box-shadow: 0px 0px 15px #888888;
}

</style>

</%block>

<%include file="/courseware/course_navigation.html" args="active_page='progress'" />

<section class="container">
  <div class="profile-wrapper">

    <section class="course-info">
      <header>
        <h1>Course Progress for Student '${student.username}' (${student.email})</h1>
      </header>

      %if not course.disable_progress_graph:
        <div id="grade-detail-graph" aria-hidden="true"></div>
      %endif

      %if len(badge_data['unlockable_badgetypes']) != 0 or len(badge_data['earned_badges']) != 0:
        <hr />
        <div>
              %for i in range(len(badge_data['earned_badges'])):
                <% badge = badge_data['earned_badges'][i] %>
                <a href="./badges"><img src="${badge['image']}" class="badgelet" badge_detail="
                    <h3>${badge['badge']['name']}</h3>
                    <p>
                    <b>${badge['badge']['description']} </b>
                      %if badge['badge'].get('criteria_text', None):
                        <br /><i>${badge['badge']['criteria_text']}</i>
                      %endif
                    </p>
                " /></a>
              %endfor
              %for i in range(len(badge_data['unlockable_badgetypes'])):
                <%badgetype = badge_data['unlockable_badgetypes'][i]%>
                <a href="./badges"><img src="${badgetype['image']}" class="badgelet unlockable" badge_detail="
                    <p>
                    <i>
                    %if badgetype.get('criteria_text', None):
                        ${badgetype['criteria_text']}
                    %endif
                    </i>
                    </p>
                " /></a>
              %endfor
            <br />
            <div style="vertical-align:middle; padding-left:20px; height:500px" id="badge_detail_box">
            </div>
        </div>

        <hr />

        %if len(badge_data['earned_badges']) != 0:
          <h2>Earned</h2>
            %for i in range(len(badge_data['earned_badges'])):
              <%badge = badge_data['earned_badges'][i]%>
                    <h3>${badge['badge']['name']}</h3>
                    <p>
                    <b>${badge['badge']['description']} </b><br />
                      issued on <b>${badge['issued_on']}</b> by
                      <a href="${badge['badge']['issuer']['origin']}">${badge['badge']['issuer']['name']}</a>
                      %if badge['badge'].get('criteria_text', None):
                        <br /><i>${badge['badge']['criteria_text']}</i>
                      %endif
                    </p>
            %endfor
        %endif
        %if len(badge_data['unlockable_badgetypes']) != 0:
          <h2>Unlockable</h2>
            %for i in range(len(badge_data['unlockable_badgetypes'])):
              <%badgetype = badge_data['unlockable_badgetypes'][i]%>
                    <p>
                    <i>
                    %if badgetype.get('criteria_text', None):
                        ${badgetype['criteria_text']}
                    %else:

                    %endif
                    </i>
                    </p>
            %endfor
        %endif
      %endif

      <ol class="chapters">
        %for chapter in courseware_summary:
        %if not chapter['display_name'] == "hidden":
        <li>
          <h2>${ chapter['display_name'] }</h2>

          <ol class="sections">
            %for section in chapter['sections']:
            <li>
              <%
              earned = section['section_total'].earned
              total = section['section_total'].possible
              percentageString = "{0:.0%}".format( float(earned)/total) if earned > 0 and total > 0 else ""
              %>

              <h3><a href="${reverse('courseware_section', kwargs=dict(course_id=course.id, chapter=chapter['url_name'], section=section['url_name']))}">
                ${ section['display_name'] }
                %if total > 0 or earned > 0:
                  <span class="sr">
                    ${"{0:.3n} of {1:.3n} possible points".format( float(earned), float(total) )}
                  </span></a>
                %endif
                %if total > 0 or earned > 0:
                  <span> ${"({0:.3n}/{1:.3n}) {2}".format( float(earned), float(total), percentageString )}</span>
                %endif
              </h3>
              <p>
                ${section['format']}

                %if section.get('due') is not None:
                  <em>
                  due ${get_default_time_display(section['due'], course.show_timezone)}
                  </em>
                %endif
              </p>

              <section class="scores">
                %if len(section['scores']) > 0:
                  <h3> ${ "Problem Scores: " if section['graded'] else "Practice Scores: "} </h3>
                  <ol>
                    %for score in section['scores']:
                    <li>${"{0:.3n}/{1:.3n}".format(float(score.earned),float(score.possible))}</li>
                    %endfor
                  </ol>
                %else:
                  <h3 class="no-scores"> No problem scores in this section </h3>
                %endif
              </section>


            </li> <!--End section-->
            %endfor
          </ol> <!--End sections-->
        </li> <!--End chapter-->
        %endif
        %endfor
      </ol> <!--End chapters-->

    </section>
  </div>
</section>
